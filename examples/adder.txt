-- Source
let fun adder x = \y -> x + y in
let add3 = adder 3 in
add3 5

-- CPS
letfun adder x k0 =
  letfun adder' y k1 = let t0 = x + y in k1 t0 in
  k0 adder'
in
letcont k2 add3 = add3 5 halt in
adder 3 k2

-- CC
letfun {} adder x k0 =
  letfun {x = x} adder' y k1 = let t0 = x + y in k1 t0 in
  k0 adder'
in
letcont {} k2 add3 = add3 5 halt in
adder 3 k2

-- Hoist
deffun {x} adder'_code y k1 = let t0 = x + y in k1 t0 in
deffun {} adder_code x k0 =
  letfun adder' = {x = x} adder'_code in
  k0 adder'
in
-- Here is part of the problem: mixed between allocation and declaration.
-- Also, allocation at top level? (but empty env, so okay)
letfun adder = {} adder_code in
defcont {} k2_code add3 = add3 5 halt in
letcont k2 = {} k2_code in
adder 3 k2

